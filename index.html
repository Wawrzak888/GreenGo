<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GreenGo üõí</title>
    
    <!-- KOLORYSTYKA SYSTEMOWA (Domy≈õlnie ciemna, zmieniana przez JS) -->
    <meta name="theme-color" content="#1e1e1e" id="metaThemeColor">
    <meta name="description" content="Osobisty planer zakup√≥w Mobile First">
    
    <!-- KONFIGURACJA PWA (PE≈ÅNY EKRAN DLA IOS) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GreenGo">

    <!-- KONFIGURACJA PWA (WYMUSZENIE PE≈ÅNEGO EKRANU DLA ANDROID - LEGACY) -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- IKONA APLIKACJI -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõí</text></svg>">

    <!-- LINK DO MANIFESTU (opcjonalny) -->
    <link rel="manifest" href="manifest.json">

    <style>
        /* --- DEFINICJA ZMIENNYCH (MOTYW CIEMNY - DOMY≈öLNY) --- */
        :root {
            --red: #ff6b6b;
            --green: #2ecc71;
            --gray: #a0a0a0;
            
            /* DARK MODE PALETTE (DEFAULT) */
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --text-main: #ecf0f1;
            --text-muted: #a0a0a0;
            --border-color: #333333;
            --input-bg: #2c2c2c;
            --shadow: 0 4px 6px rgba(0,0,0,0.3);
            --radius: 12px;
            
            /* Przycisk motywu */
            --theme-btn-bg: rgba(255,255,255,0.1);
        }

        /* --- MOTYW JASNY (Klasa dodawana do body) --- */
        body.light-mode {
            --bg-body: #f0f2f5;      /* Jasne szare t≈Ço */
            --bg-card: #ffffff;      /* Bia≈Çe karty */
            --text-main: #1a1a1a;    /* Prawie czarny tekst */
            --text-muted: #666666;   /* Ciemniejszy szary dla opis√≥w */
            --border-color: #e0e0e0; /* Jasne ramki */
            --input-bg: #f1f3f4;     /* Jasne t≈Ço input√≥w */
            --shadow: 0 4px 10px rgba(0,0,0,0.1); /* Delikatniejszy cie≈Ñ */
            
            --theme-btn-bg: rgba(0,0,0,0.05);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            overscroll-behavior-y: none;
            transition: background-color 0.3s, color 0.3s; /* P≈Çynne przej≈õcie motywu */
        }

        /* --- HEADER --- */
        header {
            background: var(--bg-card);
            padding: 15px 20px;
            box-shadow: var(--shadow);
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 80px;
            flex-shrink: 0;
            border-bottom: 1px solid var(--border-color);
            padding-top: max(15px, env(safe-area-inset-top));
            position: relative; /* Dla pozycjonowania przycisku motywu */
            transition: background-color 0.3s, border-color 0.3s;
        }

        /* Przycisk zmiany motywu */
        .theme-toggle-btn {
            position: absolute;
            top: max(15px, env(safe-area-inset-top));
            right: 15px;
            background: var(--theme-btn-bg);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s, background 0.3s;
        }
        .theme-toggle-btn:active {
            transform: scale(0.9);
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--green);
            margin-bottom: 5px;
            letter-spacing: -0.5px;
            text-align: center;
            line-height: 1;
        }

        .app-slogan {
            font-size: 0.75rem;
            color: var(--text-main);
            opacity: 0.6;
            letter-spacing: 6px;
            margin-bottom: 12px;
            font-weight: 500;
            text-transform: uppercase;
            text-align: center;
            margin-right: -6px;
        }

        .view-title {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0.8;
            border-top: 1px solid var(--border-color);
            padding-top: 10px;
            width: 100%;
            text-align: center;
            transition: border-color 0.3s;
        }

        main {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 160px; 
            position: relative;
            -webkit-overflow-scrolling: touch; 
        }

        /* --- FOOTER --- */
        footer {
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            z-index: 20;
            padding-bottom: env(safe-area-inset-bottom);
            padding-top: 5px;
            transition: background-color 0.3s, border-color 0.3s;
        }

        .footer-nav-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
            align-items: center;
        }

        .footer-credits {
            font-size: 0.55rem; 
            color: var(--text-muted);
            margin-top: 4px;
            margin-bottom: 8px; 
            text-align: center;
            opacity: 0.5; 
            padding: 0 15px;
            line-height: 1.2;
            max-width: 90%;
        }

        .nav-btn {
            background: none;
            border: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            color: var(--text-muted);
            padding: 8px 10px; 
            cursor: pointer;
            transition: color 0.2s;
        }

        .nav-btn.active {
            color: var(--green);
            font-weight: bold;
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }

        /* --- COMMON UI ELEMENTS --- */
        .date-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: var(--bg-card);
            padding: 10px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            color: var(--text-main);
            transition: background-color 0.3s, color 0.3s;
        }

        .date-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            padding: 5px 15px;
            cursor: pointer;
            color: var(--text-main);
        }

        .current-date-label {
            font-weight: 600;
            font-size: 1rem;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #itemInput {
            flex: 1;
            padding: 12px;
            background-color: var(--input-bg);
            color: var(--text-main);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s, background-color 0.3s, color 0.3s;
        }

        #itemInput:focus {
            border-color: var(--green);
        }

        #addBtn {
            background: var(--green);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: var(--radius);
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* --- LIST ITEMS --- */
        .shopping-list {
            list-style: none;
        }

        .item-row {
            background: var(--bg-card);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            transition: transform 0.2s, opacity 0.2s, background-color 0.3s;
            animation: slideIn 0.3s ease-out;
            border: 1px solid transparent;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .item-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            cursor: pointer;
        }

        .checkbox {
            font-size: 1.2rem;
            min-width: 24px;
            filter: grayscale(0.2);
        }

        .item-text {
            font-size: 1rem;
            transition: color 0.3s, font-weight 0.3s;
            word-break: break-word;
            color: var(--text-main);
        }

        .delete-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            padding: 5px;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
            /* W light mode kosz by≈Çby za jasny je≈õli u≈ºyjemy filtra, wiƒôc resetujemy filtr dla light mode */
            filter: grayscale(100%); 
        }
        
        /* W ciemnym trybie chcemy ja≈õniejszy kosz */
        body:not(.light-mode) .delete-btn {
            filter: grayscale(100%) brightness(150%);
        }

        .delete-btn:hover {
            opacity: 1;
        }

        .move-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            padding: 5px;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        .move-btn:hover { opacity: 1; }

        /* --- STATUS STYLES --- */
        .status-todo .item-text {
            color: var(--red); /* Red overrides text-main for emphasis */
            font-weight: 700;
        }
        .status-todo .checkbox::after {
            content: "‚¨ú"; 
        }
        /* Specyficzne nadpisanie dla light mode dla pustego checkboxa, ≈ºeby nie by≈Ç za jasny */
        body.light-mode .status-todo .checkbox::after {
            content: "‚¨ú";
            filter: invert(1) opacity(0.5); /* Odwr√≥cenie kolor√≥w dla lepszej widoczno≈õci na bia≈Çym */
        }

        .status-done .item-text {
            color: var(--green);
            font-weight: 400;
            text-decoration: line-through;
            opacity: 0.7;
        }
        .status-done .checkbox::after {
            content: "‚úÖ";
        }

        /* --- GRID VIEWS --- */
        .grid-container {
            display: grid;
            gap: 10px;
        }
        
        .week-grid { grid-template-columns: 1fr; }
        
        .month-grid {
            grid-template-columns: repeat(7, 1fr);
            background: var(--bg-card);
            padding: 10px;
            border-radius: var(--radius);
            gap: 6px; 
            transition: background-color 0.3s;
        }

        .day-header {
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-muted);
            padding-bottom: 5px;
            font-weight: bold;
        }

        .tile {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: transform 0.1s, background-color 0.3s;
            color: var(--text-main);
        }
        
        .tile:active { transform: scale(0.98); }

        /* Month View Cell */
        .calendar-cell {
            aspect-ratio: 1/1;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border-radius: 8px;
            font-size: 1.8rem; 
            font-weight: 700;  
            position: relative;
            border: 1px solid var(--border-color);
            background-color: transparent;
            transition: background-color 0.2s, border-color 0.3s;
            color: var(--text-main);
        }

        .calendar-cell.today {
            border: 2px solid var(--text-main);
            font-weight: 900; 
            z-index: 2; 
        }
        
        .month-status-icon {
            position: absolute;
            top: 3px;
            right: 3px;
            font-size: 1.4rem;
            line-height: 1;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
        }

        /* --- COLORS & MODIFIERS --- */
        .week-date-num.status-red {
            color: var(--red);
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.2);
        }
        .week-date-num.status-green {
            color: var(--green);
        }
        
        .week-status-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .week-row-layout {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .week-day-name { font-size: 0.9rem; color: var(--text-muted); }
        .week-date-num { font-size: 1.5rem; font-weight: 700; }

        /* Calendar Colored Status */
        .calendar-cell.status-red {
            background-color: var(--red);
            color: #fff; 
            border-color: var(--red);
        }
        .calendar-cell.status-green {
            background-color: var(--green);
            color: #1e1e1e; /* Ciemny tekst na zielonym */
            border-color: var(--green);
        }
        .calendar-cell.today.status-red, 
        .calendar-cell.today.status-green {
            border: 2px solid #fff;
        }

        .empty-state {
            text-align: center;
            color: var(--text-muted);
            margin-top: 50px;
        }

        .month-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: var(--text-main);
        }

        .month-moved-icon {
            position: absolute;
            bottom: 3px;
            left: 3px;
            font-size: 1.2rem;
            line-height: 1;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-card {
            background: var(--bg-card);
            color: var(--text-main);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 16px;
            width: 90%;
            max-width: 420px;
        }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 12px; }
    </style>
</head>
<body>

    <header>
        <!-- Przycisk zmiany motywu -->
        <button id="themeToggle" class="theme-toggle-btn" aria-label="Zmie≈Ñ motyw">
            ‚òÄÔ∏è
        </button>

        <h1>GreenGo üõí</h1>
        <div class="app-slogan">PLANUJ SWOJE ZAKUPY</div>
        <div class="view-title" id="viewTitle">Widok Dnia</div>
    </header>

    <main id="appContainer">
        <!-- Content injected via JS -->
    </main>

    <footer>
        <div class="footer-nav-container">
            <button class="nav-btn active" onclick="app.changeView('day')" id="btnDay">
                <span class="nav-icon">üìù</span>
                <span>Dzie≈Ñ</span>
            </button>
            <button class="nav-btn" onclick="app.changeView('week')" id="btnWeek">
                <span class="nav-icon">üìÖ</span>
                <span>Tydzie≈Ñ</span>
            </button>
            <button class="nav-btn" onclick="app.changeView('month')" id="btnMonth">
                <span class="nav-icon">üìÜ</span>
                <span>MiesiƒÖc</span>
            </button>
            <button class="nav-btn" onclick="app.shareApp()" id="btnShare">
                <span class="nav-icon">üì§</span>
                <span>Udostƒôpnij</span>
            </button>
        </div>
        <div class="footer-credits">
            Aplikacja autorstwa Tomasza Wawrzaka, powsta≈Ça z konieczno≈õci i ciƒÖg≈Çego zapominania üòâ
        </div>
    </footer>

    <script>
        /**
         * GreenGo Application Logic
         * Architecture: Simple State Management + LocalStorage Persistence
         */

        // --- THEME MANAGER ---
        const ThemeManager = {
            init: function() {
                const savedTheme = localStorage.getItem('greengo_theme');
                const btn = document.getElementById('themeToggle');
                
                // Domy≈õlnie ciemny (null), je≈õli zapisano 'light', w≈ÇƒÖczamy jasny
                if (savedTheme === 'light') {
                    document.body.classList.add('light-mode');
                    btn.textContent = 'üåô';
                    this.updateMetaColor('#ffffff');
                } else {
                    btn.textContent = '‚òÄÔ∏è';
                    this.updateMetaColor('#1e1e1e');
                }

                // Listener na przycisk
                btn.onclick = () => this.toggle();
            },

            toggle: function() {
                const body = document.body;
                const btn = document.getElementById('themeToggle');
                
                body.classList.toggle('light-mode');
                
                if (body.classList.contains('light-mode')) {
                    localStorage.setItem('greengo_theme', 'light');
                    btn.textContent = 'üåô'; // Ikona ksiƒô≈ºyca ≈ºeby wr√≥ciƒá do ciemnego
                    this.updateMetaColor('#ffffff');
                } else {
                    localStorage.setItem('greengo_theme', 'dark');
                    btn.textContent = '‚òÄÔ∏è'; // Ikona s≈Ço≈Ñca ≈ºeby w≈ÇƒÖczyƒá jasny
                    this.updateMetaColor('#1e1e1e');
                }
            },

            updateMetaColor: function(color) {
                document.getElementById('metaThemeColor').setAttribute('content', color);
            }
        };

        const Utils = {
            formatDateKey: (date) => {
                const d = new Date(date);
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            },
            
            getReadableDate: (date) => {
                const options = { weekday: 'long', day: 'numeric', month: 'numeric' };
                return date.toLocaleDateString('pl-PL', options);
            },

            getMonthName: (date) => {
                return date.toLocaleDateString('pl-PL', { month: 'long', year: 'numeric' });
            },
            
            getDayStatus: (dateStr) => {
                const data = Storage.get(dateStr);
                if (!data || data.length === 0) return 'gray';
                const hasPending = data.some(item => !item.done);
                if (hasPending) return 'red';
                return 'green'; 
            },
            hasMovedIn: (dateStr) => {
                const data = Storage.get(dateStr);
                return data.some(item => !!item.movedFrom);
            }
        };

        const Storage = {
            get: (key) => {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : [];
            },
            set: (key, data) => {
                localStorage.setItem(key, JSON.stringify(data));
            }
        };

        class GreenGoApp {
            constructor() {
                this.currentDate = new Date();
                this.currentView = 'day'; 
                this.container = document.getElementById('appContainer');
                this.viewTitle = document.getElementById('viewTitle');
                
                // Init Theme
                ThemeManager.init();

                // Initial render
                this.render();
            }

            changeView(viewName) {
                this.currentView = viewName;
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                const btnMap = { 'day': 'btnDay', 'week': 'btnWeek', 'month': 'btnMonth' };
                document.getElementById(btnMap[viewName]).classList.add('active');
                this.render();
            }

            render() {
                this.container.innerHTML = '';
                switch(this.currentView) {
                    case 'day':
                        this.viewTitle.textContent = "Widok Dnia";
                        this.renderDayView();
                        break;
                    case 'week':
                        this.viewTitle.textContent = "Widok Tygodnia";
                        this.renderWeekView();
                        break;
                    case 'month':
                        this.viewTitle.textContent = "Widok MiesiƒÖca";
                        this.renderMonthView();
                        break;
                }
            }

            renderDayView() {
                const dateKey = Utils.formatDateKey(this.currentDate);
                let items = Storage.get(dateKey);
                items.sort((a, b) => a.done - b.done);

                const nav = document.createElement('div');
                nav.className = 'date-nav';
                nav.innerHTML = `
                    <button class="date-btn" id="prevDay">[&lt;]</button>
                    <div class="current-date-label">${Utils.getReadableDate(this.currentDate)}</div>
                    <button class="date-btn" id="nextDay">[&gt;]</button>
                `;
                
                nav.querySelector('#prevDay').onclick = () => this.shiftDate(-1);
                nav.querySelector('#nextDay').onclick = () => this.shiftDate(1);
                nav.querySelector('.current-date-label').onclick = () => {
                    this.currentDate = new Date();
                    this.render();
                };

                const inputGroup = document.createElement('div');
                inputGroup.className = 'input-group';
                inputGroup.innerHTML = `
                    <input type="text" id="itemInput" placeholder="Wpisz produkt..." autocomplete="off">
                    <button id="addBtn">‚ûï</button>
                `;

                const list = document.createElement('ul');
                list.className = 'shopping-list';

                if (items.length === 0) {
                    list.innerHTML = '<div class="empty-state">Brak zakup√≥w na ten dzie≈Ñ.<br>Dodaj co≈õ! üìù</div>';
                } else {
                    items.forEach((item) => {
                        const li = document.createElement('li');
                        li.className = `item-row ${item.done ? 'status-done' : 'status-todo'}`;
                        li.innerHTML = `
                            <div class="item-left" onclick="app.toggleItem('${dateKey}', ${item.id})">
                                <span class="checkbox"></span>
                                <span class="item-text">${item.text}</span>
                            </div>
                            <button class="move-btn" onclick="app.openMoveDialog('${dateKey}', ${item.id})">‚Ü™Ô∏è</button>
                            <button class="delete-btn" onclick="app.deleteItem('${dateKey}', ${item.id})">üóëÔ∏è</button>
                        `;
                        
                        const textSpan = li.querySelector('.item-text');
                        textSpan.onclick = (e) => {
                            e.stopPropagation();
                            const newText = prompt("Edytuj nazwƒô produktu:", item.text);
                            if (newText !== null && newText.trim() !== "") {
                                app.editItem(dateKey, item.id, newText.trim());
                            }
                        };
                        list.appendChild(li);
                    });
                }

                this.container.appendChild(nav);
                this.container.appendChild(inputGroup);
                this.container.appendChild(list);

                const input = document.getElementById('itemInput');
                const addBtn = document.getElementById('addBtn');

                const handleAdd = () => {
                    const text = input.value.trim();
                    if (!text) return;
                    this.addItem(dateKey, text);
                };

                addBtn.onclick = handleAdd;
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleAdd();
                });
            }

            renderWeekView() {
                const grid = document.createElement('div');
                grid.className = 'grid-container week-grid';
                const curr = new Date(this.currentDate);
                const day = curr.getDay();
                const diff = curr.getDate() - day + (day == 0 ? -6 : 1); 
                const monday = new Date(curr.setDate(diff));

                for (let i = 0; i < 7; i++) {
                    const loopDate = new Date(monday);
                    loopDate.setDate(monday.getDate() + i);
                    
                    const dateStr = Utils.formatDateKey(loopDate);
                    const status = Utils.getDayStatus(dateStr);
                    const dayName = loopDate.toLocaleDateString('pl-PL', { weekday: 'long' });
                    const dateNum = loopDate.toLocaleDateString('pl-PL', { day: 'numeric', month: 'numeric' });

                const tile = document.createElement('div');
                tile.className = 'tile';
                tile.onclick = () => this.goToDate(loopDate);

                let statusClass = '';
                let icon = '';
                if (status === 'red') { statusClass = 'status-red'; icon = 'üõí'; }
                if (status === 'green') { statusClass = 'status-green'; icon = '‚úÖ'; }
                const movedIn = Utils.hasMovedIn(dateStr);
                const movedIcon = movedIn ? '<span style="font-size: 1.2rem">‚Ü™Ô∏è</span>' : '';

                tile.innerHTML = `
                    <div class="week-row-layout">
                        <span class="week-day-name">${dayName}</span>
                        <div class="week-status-wrapper">
                            ${icon ? `<span style="font-size: 1.2rem">${icon}</span>` : ''}
                            ${movedIcon}
                            <span class="week-date-num ${statusClass}">${dateNum}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(tile);
                }
                this.container.appendChild(grid);
            }

            renderMonthView() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();

                const nav = document.createElement('div');
                nav.className = 'month-nav-header';
                nav.innerHTML = `
                    <button class="date-btn" onclick="app.shiftMonth(-1)">[&lt;]</button>
                    <span style="font-weight:bold; font-size:1.1rem;">${Utils.getMonthName(this.currentDate)}</span>
                    <button class="date-btn" onclick="app.shiftMonth(1)">[&gt;]</button>
                `;
                this.container.appendChild(nav);

                const grid = document.createElement('div');
                grid.className = 'grid-container month-grid';

                ['Pn', 'Wt', '≈ör', 'Cz', 'Pt', 'So', 'Nd'].forEach(d => {
                    const h = document.createElement('div');
                    h.className = 'day-header';
                    h.textContent = d;
                    grid.appendChild(h);
                });

                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                let startDayIndex = firstDay.getDay(); 
                if (startDayIndex === 0) startDayIndex = 7; 
                
                for(let i=1; i<startDayIndex; i++) {
                    grid.appendChild(document.createElement('div'));
                }

                const todayStr = Utils.formatDateKey(new Date());

                for (let i = 1; i <= lastDay.getDate(); i++) {
                    const currentDayDate = new Date(year, month, i);
                    const dateStr = Utils.formatDateKey(currentDayDate);
                    const status = Utils.getDayStatus(dateStr);
                    const movedIn = Utils.hasMovedIn(dateStr);
                    
                    const cell = document.createElement('div');
                    cell.className = 'calendar-cell';
                    if (dateStr === todayStr) cell.classList.add('today');
                    
                    let icon = '';
                    if (status === 'red') { cell.classList.add('status-red'); icon = 'üõí'; }
                    if (status === 'green') { cell.classList.add('status-green'); icon = '‚úÖ'; }
                    
                    cell.onclick = () => this.goToDate(currentDayDate);
                    const iconHtml = icon ? `<span class="month-status-icon">${icon}</span>` : '';
                    const movedHtml = movedIn ? `<span class="month-moved-icon">‚Ü™Ô∏è</span>` : '';

                    cell.innerHTML = `<span>${i}</span>${iconHtml}${movedHtml}`;
                    grid.appendChild(cell);
                }
                this.container.appendChild(grid);
            }

            addItem(dateKey, text) {
                const items = Storage.get(dateKey);
                items.push({ id: Date.now(), text: text, done: false });
                Storage.set(dateKey, items);
                this.render();
            }

            toggleItem(dateKey, id) {
                const items = Storage.get(dateKey);
                const item = items.find(i => i.id === id);
                if (item) {
                    item.done = !item.done;
                    Storage.set(dateKey, items);
                    this.render();
                }
            }

            deleteItem(dateKey, id) {
                if(!confirm("UsunƒÖƒá produkt?")) return;
                let items = Storage.get(dateKey);
                items = items.filter(i => i.id !== id);
                Storage.set(dateKey, items);
                this.render();
            }

            editItem(dateKey, id, newText) {
                const items = Storage.get(dateKey);
                const item = items.find(i => i.id === id);
                if (item) {
                    item.text = newText;
                    Storage.set(dateKey, items);
                    this.render();
                }
            }

            openMoveDialog(sourceDateKey, itemId) {
                const backdrop = document.createElement('div');
                backdrop.className = 'modal-backdrop';
                const card = document.createElement('div');
                card.className = 'modal-card';
                card.innerHTML = `
                    <div style="font-weight:600; margin-bottom:8px;">Przenie≈õ na inny dzie≈Ñ</div>
                    <input type="date" id="moveDateInput" style="width:100%; padding:10px; border-radius: var(--radius); border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-main);">
                    <div class="modal-actions">
                        <button id="cancelMove" class="date-btn">Anuluj</button>
                        <button id="confirmMove" class="date-btn">Przenie≈õ</button>
                    </div>
                `;
                backdrop.appendChild(card);
                document.body.appendChild(backdrop);

                const input = card.querySelector('#moveDateInput');
                input.value = Utils.formatDateKey(this.currentDate);

                const cleanup = () => backdrop.remove();
                card.querySelector('#cancelMove').onclick = cleanup;
                card.querySelector('#confirmMove').onclick = () => {
                    const target = input.value;
                    if (target && target !== sourceDateKey) {
                        this.moveItem(sourceDateKey, itemId, target);
                    }
                    cleanup();
                };
            }

            moveItem(sourceDateKey, itemId, targetDateKey) {
                let sourceItems = Storage.get(sourceDateKey);
                const item = sourceItems.find(i => i.id === itemId);
                if (!item) return;
                sourceItems = sourceItems.filter(i => i.id !== itemId);
                Storage.set(sourceDateKey, sourceItems);

                const targetItems = Storage.get(targetDateKey);
                const movedItem = { ...item, movedFrom: sourceDateKey };
                targetItems.push(movedItem);
                Storage.set(targetDateKey, targetItems);
                this.render();
            }

            shiftDate(days) {
                this.currentDate.setDate(this.currentDate.getDate() + days);
                this.render();
            }

            shiftMonth(months) {
                this.currentDate.setMonth(this.currentDate.getMonth() + months);
                this.render();
            }

            goToDate(date) {
                this.currentDate = date;
                this.changeView('day');
            }

            shareApp() {
                const url = window.location.href;
                if (navigator.share) {
                    navigator.share({ title: document.title, text: 'Udostƒôpnij aplikacjƒô GreenGo', url }).catch(() => {});
                    return;
                }
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(url).then(() => { alert('Link skopiowany do schowka'); }).catch(() => { prompt('Skopiuj link', url); });
                    return;
                }
                prompt('Skopiuj link', url);
            }
        }

        const app = new GreenGoApp();
    </script>
</body>
</html>
